!function(a){var b={type:"html",content:"",title:"",class:"",closeBtn:!1,url:"",ajax:{},ajax_request:null,closeOnEsc:!0,closeOnOverlayClick:!0,clone:!1,overlay:{block:void 0,tpl:'<div class="psmodal-overlay"></div>',css:{backgroundColor:"#000",opacity:.6}},container:{block:void 0,tpl:'<div class="psmodal-container">\t<div class="psmodal-container_i">\t\t<div class="psmodal-container_i2">\t\t\t\t\t</div>\t</div></div>',header:'<div class="psmodal-container_header">\t</div>',closeTpl:'<button class="psmodal-close"></button>',closeHtml:"",titleTpl:'<span class="psmodal--title-h"></span>'},wrap:void 0,body:void 0,errors:{tpl:'<div class="psmodal-error psmodal-close"></div>',autoclose_delay:2e3,ajax_unsuccessful_load:"Error"},openEffect:{type:"fade",speed:400},closeEffect:{type:"fade",speed:400},beforePsOpen:a.noop,afterPsOpen:a.noop,beforePsClose:a.noop,afterPsClose:a.noop,afterPsLoading:a.noop,afterPsLoadingOnShow:a.noop,errorPsLoading:a.noop},c=0,d=a([]),e={isEventOut:function(b,c){var d=!0;return a(b).each(function(){a(c.target).get(0)==a(this).get(0)&&(d=!1),0==a(c.target).closest("HTML",a(this).get(0)).length&&(d=!1)}),d}},f={getParentEl:function(b){var c=a(b);return c.data("psmodal")?c:(c=a(b).closest(".psmodal-container").data("psmodalParentEl"))||!1},transition:function(b,c,d,e){switch(e=void 0==e?a.noop:e,d.type){case"fade":"show"==c?b.fadeIn(d.speed,e):b.fadeOut(d.speed,e);break;case"none":"show"==c?b.show():b.hide(),e()}},prepare_body:function(b,c){a(".psmodal-close",b.body).unbind("click.psmodal").bind("click.psmodal",function(){return c.psmodal("close"),!1})},init_el:function(b,h){var i=b.data("psmodal");if(!i){if(i=h,c++,i.modalID=c,i.overlay.block=a(i.overlay.tpl),i.overlay.block.css(i.overlay.css),i.container.block=a(i.container.tpl),i.container.block.addClass(i.class),i.body=a(".psmodal-container_i2",i.container.block),h.title.length>0||h.closeBtn){var j=a(i.container.header).clone(),k=h.closeBtn?a(i.container.closeTpl).clone().html(i.container.closeHtml):"",l=a("<div></div>",{class:"psmodal--title"}),m=a(i.container.titleTpl).clone().text(a("<div></div>").append(h.title).text());j.append(l.append(m,k)),b.prepend(j)}if(h.clone?i.body.empty().append(b.clone(!0)):(b.before('<div id="psmodalReserve'+i.modalID+'" style="display: none" />'),i.body.empty().append(b)),f.prepare_body(i,b),i.closeOnOverlayClick&&i.overlay.block.add(i.container.block).click(function(c){e.isEventOut(a(">*",i.body),c)&&b.psmodal("close")}),i.container.block.data("psmodalParentEl",b),b.data("psmodal",i),d=a.merge(d,b),a.proxy(g.show,b)(),"html"==i.type)return b;if(void 0!=i.ajax.beforeSend){var n=i.ajax.beforeSend;delete i.ajax.beforeSend}if(void 0!=i.ajax.success){var o=i.ajax.success;delete i.ajax.success}if(void 0!=i.ajax.error){var p=i.ajax.error;delete i.ajax.error}var q=a.extend(!0,{url:i.url,beforeSend:function(){void 0==n?i.body.html('<div class="psmodal-loading" />'):n(i,b)},success:function(a){b.trigger("afterPsLoading"),i.afterPsLoading(i,b,a),void 0==o?i.body.html(a):o(i,b,a),f.prepare_body(i,b),b.trigger("afterPsLoadingOnShow"),i.afterPsLoadingOnShow(i,b,a)},error:function(){b.trigger("errorPsLoading"),i.errorPsLoading(i,b),void 0==p?(i.body.html(i.errors.tpl),a(".psmodal-error",i.body).html(i.errors.ajax_unsuccessful_load),a(".psmodal-close",i.body).click(function(){return b.psmodal("close"),!1}),i.errors.autoclose_delay&&setTimeout(function(){b.psmodal("close")},i.errors.autoclose_delay)):p(i,b)}},i.ajax);i.ajax_request=a.ajax(q),b.data("psmodal",i)}},init:function(c){if(c=a.extend(!0,{},b,c),!a.isFunction(this))return this.each(function(){f.init_el(a(this),a.extend(!0,{},c))});if(void 0==c)return void a.error("jquery.psmodal: Uncorrect parameters");if(""==c.type)return void a.error('jquery.psmodal: Don\'t set parameter "type"');switch(c.type){case"html":if(""==c.content)return void a.error('jquery.psmodal: Don\'t set parameter "content"');var d=c.content;return c.content="",f.init_el(a(d),c);case"ajax":return""==c.url?void a.error('jquery.psmodal: Don\'t set parameter "url"'):f.init_el(a("<div />"),c)}}},g={show:function(){var b=f.getParentEl(this);if(!1===b)return void a.error("jquery.psmodal: Uncorrect call");var c=b.data("psmodal");if(c.overlay.block.hide(),c.container.block.hide(),a("BODY").append(c.overlay.block),a("BODY").append(c.container.block),c.beforePsOpen(c,b),b.trigger("beforePsOpen"),"hidden"!=c.wrap.css("overflow")){c.wrap.data("psmodalOverflow",c.wrap.css("overflow"));var e=c.wrap.outerWidth(!0);c.wrap.css("overflow","hidden");var g=c.wrap.outerWidth(!0);g!=e&&c.wrap.css("marginRight",g-e+"px")}d.not(b).each(function(){a(this).data("psmodal").overlay.block.hide()}),f.transition(c.overlay.block,"show",d.length>1?{type:"none"}:c.openEffect),f.transition(c.container.block,"show",d.length>1?{type:"none"}:c.openEffect,function(){c.afterPsOpen(c,b),b.trigger("afterPsOpen")});var h=a("a, button, input:visible, select, textarea",b);if(h.length){var i=a(h[0]),j=a(h[h.length-1]);j.unbind("keydown.psmodal").bind("keydown.psmodal",function(a){if(9==a.keyCode&&!a.shiftKey)return i.focus(),!1}),i.unbind("keydown.psmodal").bind("keydown.psmodal",function(a){if(9==a.keyCode&&a.shiftKey)return j.focus(),!1}),setTimeout(function(){i.focus()},200)}return b},close:function(){if(!a.isFunction(this))return this.each(function(){var b=f.getParentEl(this);if(!1===b)return void a.error("jquery.psmodal: Uncorrect call");var c=b.data("psmodal");!1!==c.beforePsClose(c,b)&&(b.trigger("beforePsClose"),d.not(b).last().each(function(){a(this).data("psmodal").overlay.block.show()}),f.transition(c.overlay.block,"hide",d.length>1?{type:"none"}:c.closeEffect),f.transition(c.container.block,"hide",d.length>1?{type:"none"}:c.closeEffect,function(){c.afterPsClose(c,b),b.trigger("afterPsClose"),c.clone||a("#psmodalReserve"+c.modalID).replaceWith(c.body.find(">*")),c.overlay.block.remove(),c.container.block.remove(),b.data("psmodal",null),a(".psmodal-container").length||(c.wrap.data("psmodalOverflow")&&c.wrap.css("overflow",c.wrap.data("psmodalOverflow")),c.wrap.css("marginRight",0))}),"ajax"==c.type&&c.ajax_request.abort(),d=d.not(b))});d.each(function(){a(this).psmodal("close")})},setDefault:function(c){a.extend(!0,b,c)}};a(function(){b.wrap=a(document.all&&!document.querySelector?"html":"body")}),a(document).bind("keyup.psmodal",function(a){var b=d.last();if(b.length){b.data("psmodal").closeOnEsc&&27===a.keyCode&&b.psmodal("close")}}),a.psmodal=a.fn.psmodal=function(b){return g[b]?g[b].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof b&&b?void a.error("jquery.psmodal: Method "+b+" does not exist"):f.init.apply(this,arguments)}}(jQuery);